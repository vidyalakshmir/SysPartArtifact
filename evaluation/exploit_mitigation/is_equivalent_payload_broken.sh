#!/bin/bash


file=$1
eqfile="equivalent_list.txt"
app_folder=$2
while read -r line
do
	i=0
	isfiltered=0
	payload=""
	appname=""
	ifeq=0
	for word in $line
	do
		if [[ i -eq 0 ]]
		then 
			payload=$word
		elif [[ i -eq 1 ]]
		then
			appname=$word 
		else 
			appfile=$app_folder/$appname.txt
			#echo $appfile
			ls=$(grep -w $word $eqfile)	#is the blocked syscall in the equivalent list
			anyblock=1
			thiseq=0
			for l in $ls 
			do
				ifeq=1
				thiseq=1
				rt=$(grep -w $l $appfile | wc -l)	#is the equivalent syscall blocked
				if [[ rt -gt 0 ]]
				then 
					printf "\n%s %s %s BLOCKED" $payload $appname $l
					continue
				else 
					anyblock=0
					printf "\n%s %s %s NOTBLOCKED" $payload $appname $l
				fi
			done 
			if [[ thiseq -eq 1 ]]			#has equivalent
			then
				if [[ anyblock -eq 1 ]] #are all equivalents blocked
				then
					isfiltered=1 		#payload is blocked by app
				fi
			fi
		fi
		i=$((i+1))
	done
	if [[ ifeq -ne 0 ]]
	then
		if [[ isfiltered -eq 1 ]]
		then 
			printf "\n%s %s YES" $payload $appname 
		else 
			printf "\n%s %s NO" $payload $appname 
		fi 
	fi
done < $file
